<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Climate Chart</title>
  <style>
    :root {
      --temp:   #c5352b;
      --precip: #3f7fd8;
      --border: #c8ccd1;
      --page-bg:#f8f9fa;
    }

    body {
      margin: 0;
      padding: 24px;
      background: var(--page-bg);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                   sans-serif;
      color: #111;
    }

    .chart-wrapper {
      width: 650px;
      margin: 0 auto;
      background: #fff;
      border: 1px solid var(--border);
      box-sizing: border-box;
      padding: 14px 18px 14px;
    }

    .chart-title {
      font-weight: 700;
      font-size: 20px;
      margin-bottom: 2px;
    }

    .chart-subtitle {
      font-size: 14px;
      color: #555;
      margin-bottom: 10px;
    }

    .data-sources {
      margin-top: 10px;
      padding-top: 6px;
      border-top: 1px solid var(--border);
      font-size: 10.5px;
      line-height: 1.35;
      color: #555;
    }

    .legend {
      font-size: 11px;
      margin-top: 8px;
    }

    .legend-row {
      display: flex;
      align-items: center;
      margin-bottom: 2px;
    }

    .swatch {
      width: 11px;
      height: 11px;
      border-radius: 2px;
      margin-right: 4px;
    }
  </style>
</head>
<body>

<div class="chart-wrapper">
  <div class="chart-title" id="title"></div>
  <div class="chart-subtitle" id="subtitle"></div>
  <div id="chart-container"></div>

  <div class="legend">
    <div class="legend-row">
      <div class="swatch" style="background: var(--temp);"></div>
      <span>Average max. and min. temperatures in °C</span>
    </div>
    <div class="legend-row">
      <div class="swatch" style="background: var(--precip);"></div>
      <span>Precipitation totals in mm</span>
    </div>
  </div>

  <div class="data-sources">
    <strong>Data sources:</strong>
    Baseline climate conditions are derived from CHELSA v2.1 climatological normals (1981–2010).
    Future projections use CHELSA-downscaled UKESM1-0-LL SSP5-8.5 projection normals
    for 2011–2040, 2041–2070, and 2071–2100.
    SSP5-8.5 represents a high-growth, energy-intensive future dominated by fossil fuel use, resulting in very high greenhouse gas emissions—making it a widely used analogue for present-day trajectories under minimal mitigation efforts. UKESM1-0-LL was selected due to its higher climate sensitivity and stronger land–atmosphere coupling, which makes it useful for bounding upper-risk habitability outcomes. This data has a spatial resolution of 30 arc-seconds (≈1 km at the equator).
<br><br>
    <strong>Note:</strong> the "Dickinson Classification" refers to the system introduced in Dickinson, C. (2026). The Dickinson Climate Classification: A Taxonomic Thermal-Hydrological Partition of Climate State Space [Preprint]. Zenodo. https://doi.org/10.5281/zenodo.18264771<br><br>
    <strong>License:</strong> The Dickinson Climate Classification and this visualization are released under the Creative Commons Attribution–NonCommercial 4.0 International License (CC BY-NC 4.0)
  </div>
</div>

<script>
  // ============================
  // 1. EARTH ENGINE LINES (°C / mm INPUT)
  // ============================
  const rawLines = `
1.0: 14 8 79
2.0: 16 8 56
3.0: 18 9 68
4.0: 21 11 66
5.0: 27 16 53
6.0: 31 20 45
7.0: 33 22 39
8.0: 34 23 33
9.0: 32 20 45
10.0: 27 17 66
11.0: 19 12 80
12.0: 15 8 98
  `;

  const months = ['J','F','M','A','M','J','J','A','S','O','N','D'];

  const highsC = [], lowsC = [], precipMM = [];
  const highsF = [], lowsF = [], precipIn = [];

  // ============================
  // 2. CONVERSION (SCALING ONLY)
  // ============================
  const CtoF = c => c * 9 / 5 + 32;
  const MMtoIN = mm => mm / 25.4;

  rawLines.trim().split(/\n+/).forEach(line => {
    const nums = line.split(':')[1].trim().split(/\s+/).map(Number);

    const hiC = nums[0];
    const loC = nums[1];
    const prMM = nums[2];

    highsC.push(hiC);
    lowsC.push(loC);
    precipMM.push(prMM);

    // hidden scaling values
    highsF.push(CtoF(hiC));
    lowsF.push(CtoF(loC));
    precipIn.push(MMtoIN(prMM));
  });

  const data = {
    location: 'Cognac, France',
    code: '2071 - 2100 normals<br>Köppen Classification: Csa (hot summer mediterranean)<br>Dickinson Classification: Bma2 (tropical mediterranean with hot summer)',
    months,
    highsF,      // scaling
    lowsF,
    precipIn,
    highsC,      // labels
    lowsC,
    precipMM
  };

  document.getElementById('title').textContent = data.location;
  document.getElementById('subtitle').innerHTML = data.code;

  // ============================
  // 3. DRAW CHART (UNCHANGED)
  // ============================
  const svgWidth = 620;
  const svgHeight = 540;

  const margin = { top: 20, right: 20, bottom: 32, left: 20 };
  const tempPanelHeight = 340;
  const gap = 48;
  const precipPanelHeight = 55;

  const plotWidth = svgWidth - margin.left - margin.right;
  const tempBaseY = margin.top + tempPanelHeight;
  const precipTopY = tempBaseY + gap;
  const precipBaseY = precipTopY + precipPanelHeight;

  const n = months.length;
  const colWidth = plotWidth / n;

  const TEMP_MIN_FIXED = -30;
  const TEMP_MAX_FIXED = 130;
  const TEMP_RANGE_FIXED = TEMP_MAX_FIXED - TEMP_MIN_FIXED;

  const PRECIP_MAX_FIXED = 10;

  const tempScale = v =>
    ((v - TEMP_MIN_FIXED) / TEMP_RANGE_FIXED) * (tempPanelHeight * 0.9);

  const precipScale = v =>
    (v / PRECIP_MAX_FIXED) * (precipPanelHeight * 0.9);

  let svg = `<svg width="${svgWidth}" height="${svgHeight}">
    <rect width="${svgWidth}" height="${svgHeight}" fill="#fff" />
    <g transform="translate(${margin.left},0)">`;

  // dotted 32°F reference
  const dottedY = tempBaseY - tempScale(32);
  svg += `<line x1="0" y1="${dottedY}" x2="${plotWidth}" y2="${dottedY}"
                stroke="#bbb" stroke-width="1" stroke-dasharray="4,3"/>`;

  // temperature bars
  for (let i = 0; i < n; i++) {
    const hiH = tempScale(data.highsF[i]);
    const loH = tempScale(data.lowsF[i]);

    const barX = colWidth * i + colWidth * 0.28;
    const barW = colWidth * 0.30;
    const hiY = tempBaseY - hiH;
    const loY = tempBaseY - loH;

    svg += `
      <rect x="${barX}" y="${hiY}" width="${barW}" height="${hiH - loH}"
            fill="var(--temp)"></rect>
      <text x="${barX + barW/2}" y="${hiY - 4}" text-anchor="middle" font-size="11">
        ${data.highsC[i]}
      </text>
      <text x="${barX + barW/2}" y="${loY + 12}" text-anchor="middle" font-size="10">
        ${data.lowsC[i]}
      </text>`;
  }

  // precip bars
  for (let i = 0; i < n; i++) {
    const barH = precipScale(data.precipIn[i]);
    const barX = colWidth * i + colWidth * 0.28;
    const barW = colWidth * 0.30;
    const barY = precipBaseY - barH;

    svg += `
      <rect x="${barX}" y="${barY}" width="${barW}" height="${barH}"
            fill="var(--precip)"></rect>
      <text x="${barX + barW/2}" y="${precipBaseY + 14}"
            text-anchor="middle" font-size="10">
        ${data.precipMM[i]}
      </text>`;
  }

  const lowerLineY = precipBaseY + 20;
  svg += `<line x1="0" y1="${lowerLineY}" x2="${plotWidth}" y2="${lowerLineY}"
                stroke="#000" stroke-width="2"/>`;

  for (let i = 0; i < n; i++) {
    const x = colWidth * i + colWidth * 0.43;
    svg += `<text x="${x}" y="${lowerLineY + 16}"
                  text-anchor="middle" font-size="11">${months[i]}</text>`;
  }

  svg += `</g></svg>`;
  document.getElementById('chart-container').innerHTML = svg;
</script>

</body>
</html>
