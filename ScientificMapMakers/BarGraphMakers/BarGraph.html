<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Climate Chart</title>
  <style>
    :root {
      --temp:   #c5352b;
      --precip: #3f7fd8;
      --border: #c8ccd1;
      --page-bg:#f8f9fa;
    }

    body {
      margin: 0;
      padding: 24px;
      background: var(--page-bg);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                   sans-serif;
      color: #111;
    }

    .chart-wrapper {
      width: 650px;
      margin: 0 auto;
      background: #fff;
      border: 1px solid var(--border);
      box-sizing: border-box;
      padding: 14px 18px 14px;
    }

    .chart-title {
      font-weight: 700;
      font-size: 20px;
      margin-bottom: 2px;
    }

    .chart-subtitle {
      font-size: 14px;
      color: #555;
      margin-bottom: 10px;
    }

    .legend {
      font-size: 11px;
      margin-top: 8px;
    }

    .legend-row {
      display: flex;
      align-items: center;
      margin-bottom: 2px;
    }

    .swatch {
      width: 11px;
      height: 11px;
      border-radius: 2px;
      margin-right: 4px;
    }
  </style>
</head>
<body>

<div class="chart-wrapper">
  <div class="chart-title" id="title"></div>
  <div class="chart-subtitle" id="subtitle"></div>
  <div id="chart-container"></div>

  <div class="legend">
    <div class="legend-row">
      <div class="swatch" style="background: var(--temp);"></div>
      <span>Average max. and min. temperatures in °F</span>
    </div>
    <div class="legend-row">
      <div class="swatch" style="background: var(--precip);"></div>
      <span>Precipitation totals in inches</span>
    </div>
  </div>
</div>

<script>
  // ============================
  // 1. PASTE YOUR EARTH ENGINE LINES HERE
  // ============================
  const rawLines = `
1.0: 59 39 0.7
2.0: 63 43 1.1
3.0: 71 48 0.6
4.0: 80 55 0.2
5.0: 90 64 0.1
6.0: 99 73 0.1
7.0: 104 80 0.4
8.0: 102 78 0.4
9.0: 94 70 0.3
10.0: 81 59 0.4
11.0: 68 48 0.4
12.0: 58 39 0.6
  `;

  // ============================
  // 2. PARSE THE LINES
  // ============================
  const months = ['J','F','M','A','M','J','J','A','S','O','N','D'];
  const highsF = [], lowsF = [], precipIn = [];

  rawLines.trim().split(/\n+/).forEach(line => {
    const parts = line.split(':');
    if (parts.length < 2) return;

    const nums = parts[1].trim().split(/\s+/);
    highsF.push(parseFloat(nums[0]));
    lowsF.push(parseFloat(nums[1]));
    precipIn.push(parseFloat(nums[2]));
  });

  const data = {
    code: 'Carbondale, Illinois',
    location: '<b>Cha2</b> (1981–2010 normals)',
    months,
    highsF,
    lowsF,
    precipIn
  };

  document.getElementById('title').textContent = data.code;
  document.getElementById('subtitle').innerHTML = data.location;

  // ============================
  // 3. DRAW CHART
  // ============================
  const svgWidth = 620;
  const svgHeight = 310;

  const margin = { top: 20, right: 20, bottom: 32, left: 20 };

  const tempPanelHeight = 110;
  const gap = 42;                 // SPACE BETWEEN TEMP AND PRECIP (LARGER)
  const precipPanelHeight = 55;

  const plotWidth = svgWidth - margin.left - margin.right;
  const tempBaseY = margin.top + tempPanelHeight;
  const precipTopY = tempBaseY + gap;
  const precipBaseY = precipTopY + precipPanelHeight;

  const n = data.months.length;
  const colWidth = plotWidth / n;

  function min(arr) { return Math.min(...arr); }
  function max(arr) { return Math.max(...arr); }

  const tempMin = min(data.lowsF);
  const tempMax = max(data.highsF);
  const tempRange = tempMax - tempMin || 1;

  function tempScale(v) {
    return ((v - tempMin) / tempRange) * (tempPanelHeight * 0.9);
  }

  const precipMax = max(data.precipIn);
  const precipRange = precipMax || 1;

  function precipScale(v) {
    return (v / precipRange) * (precipPanelHeight * 0.9);
  }

  let svg = `<svg width="${svgWidth}" height="${svgHeight}">
    <rect width="${svgWidth}" height="${svgHeight}" fill="#ffffff" />
    <g transform="translate(${margin.left},0)">`;

  // ----- Temperature bars -----
  for (let i = 0; i < n; i++) {
    const hi = data.highsF[i], lo = data.lowsF[i];

    const hiH = tempScale(hi);
    const loH = tempScale(lo);

    const barX = colWidth * i + colWidth * 0.28;
    const barW = colWidth * 0.30;

    const hiY = tempBaseY - hiH;
    const loY = tempBaseY - loH;

    svg += `
      <rect x="${barX}" y="${hiY}" width="${barW}" height="${hiH - loH}"
            fill="var(--temp)"></rect>
      <text x="${barX + barW/2}" y="${hiY - 4}" text-anchor="middle"
            font-size="11">${hi}</text>
      <text x="${barX + barW/2}" y="${loY + 12}" text-anchor="middle"
            font-size="10">${lo}</text>`;
  }

  // ----- THICK LINE BETWEEN TEMP → PRECIP -----
  svg += `
    <line x1="0" y1="${precipTopY - 12}" 
          x2="${plotWidth}" y2="${precipTopY - 12}" 
          stroke="#000" stroke-width="2" />`;

  // ----- Precipitation bars -----
  for (let i = 0; i < n; i++) {
    const p = data.precipIn[i];
    const barH = precipScale(p);

    const barX = colWidth * i + colWidth * 0.28;
    const barW = colWidth * 0.30;
    const barY = precipBaseY - barH;

    svg += `
      <rect x="${barX}" y="${barY}" width="${barW}" height="${barH}"
            fill="var(--precip)"></rect>
      <text x="${barX + barW/2}" 
            y="${precipBaseY + 14}" 
            text-anchor="middle"
            font-size="10">${p}</text>`;
  }

  // ----- THICK LINE BETWEEN PRECIP → MONTH LABELS -----
  const lowerLineY = precipBaseY + 20;
  svg += `
    <line x1="0" y1="${lowerLineY}" 
          x2="${plotWidth}" y2="${lowerLineY}" 
          stroke="#000" stroke-width="2" />`;

  // ----- Month labels -----
  for (let i = 0; i < n; i++) {
    const x = colWidth * i + colWidth * 0.43;
    const y = lowerLineY + 16;
    svg += `<text x="${x}" y="${y}" text-anchor="middle"
                  font-size="11">${data.months[i]}</text>`;
  }

  svg += `</g></svg>`;

  document.getElementById('chart-container').innerHTML = svg;
</script>

</body>
</html>
