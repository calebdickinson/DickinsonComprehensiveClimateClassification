<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-L6C1HZ2LBZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-L6C1HZ2LBZ');
  </script>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/styles.css">
  <title></title>
</head>
<body>
  <div id="header">
    <h1>The Dickinson Comprehensive Climate Classification System</h1>
  </div>

  <nav>
    <a href="home.html">Home</a>
    <a href="classification.html">Classification</a>
    <a href="maps.html">Maps</a>
    <a href="about.html">About</a>
  </nav>

  <main>
    <h1 id="climate_name"></h1>

    <div class="climate-code">
      <h2><strong id="climate_exists"></strong></h2>
    </div>

    <div class="buttons-with-code">
      <div class="buttons-group">
        <button class="warmer" id="climate_go_to_hotter_summer"><-- Warmer Summers</button>
        <button class="warmer" id="climate_go_to_hotter_winter"><-- Warmer Winters</button>
      </div>
      <div class="climate-code">
        <h2>Climate Code: <strong id="climate_code"></strong></h2>
      </div>
      <div class="buttons-group buttons-group_right">
        <button class="colder" id="climate_go_to_colder_summer">Colder Summers --></button>
        <button class="colder" id="climate_go_to_colder_winter">Colder Winters --></button>
      </div>
    </div>

    <div class="box" id="ariditySection" hidden>
      <div class="ariditybox-border-outer">
        <div class="ariditybox-border-inner">
          <div class="ariditybox-grid">
            <button id="climate_go_to_humid"           class="ariditybox ariditybox-humid">Humid (H)</button>
            <button id="climate_go_to_semihumid"       class="ariditybox ariditybox-semihumid">Semihumid (G)</button>
            <button id="climate_go_to_monsoon"         class="ariditybox ariditybox-monsoon">Monsoon<br><br>(W)</button>
            <button id="climate_go_to_mediterranean"   class="ariditybox ariditybox-mediterranean">Mediter-<br>ranean<br><br>(M)</button>
            <button id="climate_go_to_semiarid"        class="ariditybox ariditybox-semiarid">Semiarid (S)</button>
            <button id="climate_go_to_arid_desert"     class="ariditybox ariditybox-arid-desert">Arid Desert (D)</button>
          </div>
        </div>
      </div>
    </div>

    <div id="landscapes">
      <img id="climate_landscape" src="" alt="landscape in this climate">
    </div>

    <!-- Cities (neutral four-slot system) -->
    <div id="cities">
      <div id="cities1" class="cities-block">
        <h3>Cities with this climate (Period 1)</h3>
        <ul id="climate_cities1"></ul>
      </div>
      <div id="cities2" class="cities-block">
        <h3>Cities with this climate (Period 2)</h3>
        <ul id="climate_cities2"></ul>
      </div>
      <div id="cities3" class="cities-block">
        <h3>Cities with this climate (Period 3)</h3>
        <ul id="climate_cities3"></ul>
      </div>
      <div id="cities4" class="cities-block">
        <h3>Cities with this climate (Period 4)</h3>
        <ul id="climate_cities4"></ul>
      </div>
    </div>

    <!-- Maps (neutral four-slot system) -->
    <div id="map1">
      <h3>Global distribution of this climate<br>(1981 - 2010 normals)</h3>
      <img id="climate_map_1" src="" alt="World climate map (1981 - 2010 normals)">
    </div>
    <div id="map2">
      <h3>Global distribution of this climate<br>(2011 - 2040 High Emissions normals)</h3>
      <img id="climate_map_2" src="" alt="World climate map (2011 - 2040 High Emissions normals)">
    </div>
    <div id="map3">
      <h3>Global distribution of this climate<br>(2041 - 2070 High Emissions normals)</h3>
      <img id="climate_map_3" src="" alt="World climate map (2041 - 2070 High Emissions normals)">
    </div>
    <div id="map4">
      <h3>Global distribution of this climate<br>(2071 - 2100 High Emissions normals)</h3>
      <img id="climate_map_4" src="" alt="World climate map (2071 - 2100 High Emissions normals)">
    </div>
    <!-- United States maps (optional four-slot system) -->
    <div id="map1usa">
      <h3>United States distribution of this climate<br>(1981 - 2010 normals)</h3>
      <img id="climate_map_1_usa" src="" alt="United States climate map (1981 - 2010 normals)">
    </div>
    <div id="map2usa">
      <h3>United States distribution of this climate<br>(2011 - 2040 High Emissions normals)</h3>
      <img id="climate_map_2_usa" src="" alt="United States climate map (2011 - 2040 High Emissions normals)">
    </div>
    <div id="map3usa">
      <h3>United States distribution of this climate<br>(2041 - 2070 High Emissions normals)</h3>
      <img id="climate_map_3_usa" src="" alt="United States climate map (2041 - 2070 High Emissions normals)">
    </div>
    <div id="map4usa">
      <h3>United States distribution of this climate<br>(2071 - 2100 High Emissions normals)</h3>
      <img id="climate_map_4_usa" src="" alt="United States climate map (2071 - 2100 High Emissions normals)">
    </div>
    <!-- Europe maps (optional four-slot system) -->
    <div id="map1europe">
      <h3>Europe distribution of this climate<br>(1981 - 2010 normals)</h3>
      <img id="climate_map_1_europe" src="" alt="Europe climate map (1981 - 2010 normals)">
    </div>
    <div id="map2europe">
      <h3>Europe distribution of this climate<br>(2011 - 2040 High Emissions normals)</h3>
      <img id="climate_map_2_europe" src="" alt="Europe climate map (2011 - 2040 High Emissions normals)">
    </div>
    <div id="map3europe">
      <h3>Europe distribution of this climate<br>(2041 - 2070 High Emissions normals)</h3>
      <img id="climate_map_3_europe" src="" alt="Europe climate map (2041 - 2070 High Emissions normals)">
    </div>
    <div id="map4europe">
      <h3>Europe distribution of this climate<br>(2071 - 2100 High Emissions normals)</h3>
      <img id="climate_map_4_europe" src="" alt="Europe climate map (2071 - 2100 High Emissions normals)">
    </div>
  </main>

  <!-- get data for specific climate code -->
<script>
  const url = new URL(location.href);
  const codeParam = url.searchParams.get('code');
  if (!codeParam) throw new Error("No climate code specified in URL");

  const PERIOD_LABELS = {
    map1: "1981-2010 normals",
    map2: "2011-2040 High Emissions normals",
    map3: "2041-2070 High Emissions normals",
    map4: "2071-2100 High Emissions normals",
  };

  // Navigation that always rewrites to canonical casing
  function change_climate(nextCode, CANON) {
    const canon = (s) => CANON.get(String(s).trim().toLowerCase()) || s;
    const target = canon(nextCode);
    const u = new URL(location.href);
    u.searchParams.set('code', target);
    location.href = u.toString();
  }

  // Load data and render
  fetch('data/data.json')
    .then(r => r.json())
    .then(data => {
      // Build a case-insensitive map of all valid codes in data.json
      const CANON = new Map(Object.keys(data).map(k => [k.toLowerCase(), k]));

      // Resolve the URL code to the exact JSON key (canonicalize)
      const canonCode = CANON.get(codeParam.toLowerCase());
      if (!canonCode) {
        throw new Error(`Climate code '${codeParam}' not found in data.json`);
      }
      // If the URL casing is wrong, silently fix it (no new history entry)
      if (canonCode !== codeParam) {
        const u = new URL(location.href);
        u.searchParams.set('code', canonCode);
        history.replaceState(null, '', u.toString());
      }

      const climate = data[canonCode];
      const climate_code = climate['code']; // keep original casing from JSON

      // Basic headings
      document.getElementById('climate_name').textContent = climate['name'] + " Climate";
      document.getElementById('climate_code').textContent = climate_code;

      // Map path helpers (exact-case filenames)
      const MAP_DIR = 'images/maps';
      const g = n => `${MAP_DIR}/${climate_code}-map${n}.png`;
      const uS = n => `${MAP_DIR}/${climate_code}-map${n}usa.png`;
      const eU = n => `${MAP_DIR}/${climate_code}-map${n}europe.png`;

      // Image setter (donâ€™t hide section, just hide broken img)
      function setMapImage(imgId, url) {
        const img = document.getElementById(imgId);
        if (!img) return;
        if (!url || url.trim() === "") { img.style.display = 'none'; return; }
        img.onerror = () => { img.style.display = 'none'; console.warn(`Map not found: ${url}`); };
        img.src = url;
      }

      // Apply images (fallback to derived paths)
      setMapImage('climate_map_1', climate['map1'] || g(1));
      setMapImage('climate_map_2', climate['map2'] || g(2));
      setMapImage('climate_map_3', climate['map3'] || g(3));
      setMapImage('climate_map_4', climate['map4'] || g(4));

      setMapImage('climate_map_1_usa', climate['map1usa'] || uS(1));
      setMapImage('climate_map_2_usa', climate['map2usa'] || uS(2));
      setMapImage('climate_map_3_usa', climate['map3usa'] || uS(3));
      setMapImage('climate_map_4_usa', climate['map4usa'] || uS(4));

      setMapImage('climate_map_1_europe', climate['map1europe'] || eU(1));
      setMapImage('climate_map_2_europe', climate['map2europe'] || eU(2));
      setMapImage('climate_map_3_europe', climate['map3europe'] || eU(3));
      setMapImage('climate_map_4_europe', climate['map4europe'] || eU(4));

      // Landscape
      const landscape = document.getElementById('climate_landscape');
      landscape.src = climate['landscape'] || `images/landscapes/${climate_code}.jpg`;
      landscape.onerror = () => (landscape.style.display = 'none');

      // Wire nav buttons (canonicalize targets before navigating)
      const bind = (btnId, key) => {
        const btn = document.getElementById(btnId);
        const dest = climate[key];
        if (dest && dest !== "False") {
          btn.onclick = () => change_climate(dest, CANON);
        } else {
          btn.disabled = true;
        }
      };
      bind('climate_go_to_hotter_summer', 'go_to_hotter_summer');
      bind('climate_go_to_colder_summer', 'go_to_colder_summer');
      bind('climate_go_to_hotter_winter', 'go_to_hotter_winter');
      bind('climate_go_to_colder_winter', 'go_to_colder_winter');
    })
    .catch(err => {
      console.error(err);
      alert(err.message);
    });
  </script>
</body>
</html>
