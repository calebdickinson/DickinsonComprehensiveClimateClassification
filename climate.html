<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-L6C1HZ2LBZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-L6C1HZ2LBZ');
  </script>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/styles.css">
    <title></title>
</head>
<body>
  <div id="header">
    <h1>The Dickinson Comprehensive Climate Classification System</h1>
  </div>
  <nav>
    <a href="home.html">Home</a>
    <a href="classification.html">Classification</a>
    <a href="maps.html">Maps</a>
    <a href="about.html">About</a>
  </nav>
  <main>
    <h1 id="climate_name"></h1>
    <div class="buttons-with-code">
      <div class="buttons-group">
        <button class="warmer" id="climate_warm_plus"><-- Warmer Summers</button>
        <button class="warmer" id="climate_cold_plus"><-- Warmer Winters</button>
      </div>
      <div class="climate-code">
        <h2>Climate Code: <strong id="climate_code"></strong></h2>
      </div>
      <div class="buttons-group buttons-group_right">
        <button class="colder" id="climate_warm_minus">Colder Summers --></button>
        <button class="colder" id="climate_cold_minus">Colder Winters --></button>
      </div>
    </div>

        <!-- <img id="landscape" src="" alt="landscape in this climate"> -->

        <h3>Cities with this climate</h3>
        <p id="climate_cities"></p>
        <br>
        <br>
        <br>
        <br>
        <h3>Global climate distribution</h3>
        <p><i id="distribution_message"></i></p>

        <br> <br>
        <p><b>1960-1900 normals</b></p>
        <img id="climate_map_1900s" src="" alt="climate map in 1900">
        
        <br> <br>
        <p><b>2025</b></p>
        <img id="climate_map_2025" src="" alt="climate map in 2025">

        <br> <br>
        <p><b>2100 projection</b></p>
        <img id="climate_map_2100" src="" alt="climate map in 2100">
  </main>


  <!-- get data for specific climate code -->
  <script>
    const code = new URLSearchParams(location.search).get('code');

    if (!code) {
        throw new Error("No climate code specified in URL");
    }

    fetch('data.json')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            const climate = data[code];
            const climate_name = climate['name'];
            const climate_code = climate['code'];
            const climate_cities = climate['cities'];
            const climate_map_2025 = climate['map_2025'];
            const climate_map_2100 = climate['map_2100'];
            const climate_map_1900s = climate['map_1900s'];
            const climate_landscape = climate['landscape'];
            const climate_arid_plus = climate['arid_plus'];
            const climate_arid_minus = climate['arid_minus'];
            const climate_warm_plus = climate['warm_plus'];
            const climate_warm_minus = climate['warm_minus'];
            const climate_cold_plus = climate['cold_plus'];
            const climate_cold_minus = climate['cold_minus'];
            const distribution_message = "See the global distribution of " + climate_name + " over time. Note that map data for oceans and Antarctica is not available.";

            if (!climate) {
                throw new Error(`Climate data for code "${code}" not found`);
            }

            document.getElementById('climate_name').textContent = climate_name;
            document.getElementById('climate_code').textContent = climate_code;
            document.getElementById('distribution_message').textContent = distribution_message;


            if (climate_cities && climate_cities.length > 0) document.getElementById('climate_cities').innerHTML = climate_cities.join("<br>");
            else document.getElementById('climate_cities').textContent = "There are no cities with this climate";

            function change_climate(code) {
                window.location.href = window.location.pathname + '?code=' + code;
            }

            function is_disabled(value) {
                return value === "False" || value === "false" || value === false || value === "" || value === undefined || value === null
            }

            function set_image(elementId, src, alt, fallbackMessage) {
                const img = document.getElementById(elementId);
                img.src = src;
                img.alt = alt;
                
                img.onerror = function() {
                    // Replace the image with a div containing the error message
                    const parent = img.parentNode;
                    const errorDiv = document.createElement('div');
                    errorDiv.innerHTML = fallbackMessage;
                    errorDiv.style.padding = '20px';
                    errorDiv.style.backgroundColor = '#f8d7da';
                    errorDiv.style.color = '#721c24';
                    errorDiv.style.border = '1px solid #f5c6cb';
                    errorDiv.style.borderRadius = '5px';
                    errorDiv.style.textAlign = 'center';
                    parent.replaceChild(errorDiv, img);
                };
            }

            function show_error(message) {
                const errorDiv = document.createElement('div');
                errorDiv.innerHTML = message;
                errorDiv.style.padding = '20px';
                errorDiv.style.backgroundColor = '#f8d7da';
                errorDiv.style.color = '#721c24';
                errorDiv.style.border = '1px solid #f5c6cb';
                errorDiv.style.borderRadius = '5px';
                errorDiv.style.textAlign = 'center';
                document.body.appendChild(errorDiv);
            }

            // if (climate_arid_plus == "False") document.getElementById('climate_arid_plus').disabled = true;
            // else document.getElementById('climate_arid+').onclick = () => change_climate(climate_arid_plus);
            // if (climate_arid_minus == "False") document.getElementById('climate_arid_minus').disabled = true;
            // else document.getElementById('climate_arid-').onclick = () => change_climate(climate_arid_minus);
            if (is_disabled(climate_warm_plus)) document.getElementById('climate_warm_plus').disabled = true;
            else document.getElementById('climate_warm_plus').onclick = () => change_climate(climate_warm_plus);
            if (is_disabled(climate_warm_minus)) document.getElementById('climate_warm_minus').disabled = true;
            else document.getElementById('climate_warm_minus').onclick = () => change_climate(climate_warm_minus);
            if (is_disabled(climate_cold_plus)) document.getElementById('climate_cold_plus').disabled = true;
            else document.getElementById('climate_cold_plus').onclick = () => change_climate(climate_cold_plus);
            if (is_disabled(climate_cold_minus)) document.getElementById('climate_cold_minus').disabled = true;
            else document.getElementById('climate_cold_minus').onclick = () => change_climate(climate_cold_minus);

            // if (is_disabled(climate_landscape) || climate_landscape.length === 0) set_image('landscape', 'images/no_image_available.png', 'landscape_container', 'No landscape image available');
            // else {
            //     for (let i = 0; i < climate_landscape.length; i++) {
            //         set_image(climate_landscape[i], 'landscape_container', climate_name + " landscape " + (i + 1));
            //     }
            // }

            set_image('climate_map_2025', climate_map_2025, "Global distribution (2025)", "Map not available");
            set_image('climate_map_2100', climate_map_2100, "Global distribution (2100)", "Map not available");
            set_image('climate_map_1900s', climate_map_1900s, "Global distribution (1961-1900 normals)", "Map not available");

            document.getElementById('climate_landscape').src = climate_landscape;
            document.getElementById('climate_landscape').alt = climate_name + " landscape";
        })
        .catch(error => {
            throw new Error("Error loading climate data: " + error.message);
        });
  </script>
</body>
</html>